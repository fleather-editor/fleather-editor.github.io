<!DOCTYPE html>
<html lang="en-US">

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=283500f91980d91031e083409342feab137f96f8">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Data Format and Document Model | Fleather</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Data Format and Document Model" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/doc/concepts/data-and-document.html" />
<meta property="og:url" content="http://localhost:4000/doc/concepts/data-and-document.html" />
<meta property="og:site_name" content="Fleather" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Data Format and Document Model" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"Data Format and Document Model","url":"http://localhost:4000/doc/concepts/data-and-document.html"}</script>
<!-- End Jekyll SEO tag -->

    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          
            <a id="forkme_banner" href="https://github.com/fleather-editor/fleather-editor.github.io">View on GitHub</a>
          

          <h1 id="project_title">Fleather</h1>
          <h2 id="project_tagline"></h2>

          
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2 id="data-format-and-document-model">Data Format and Document Model</h2>

<p>Fleather document model exists as a separate platform-agnostic library
called Parchment. Parchment implements all building blocks of a rich text
document and can be used separately from Fleather on any platform
supported by Dart SDK, e.g. web, desktop or server (macos, windows,
linux) and, of course, mobile (ios, android).</p>

<p>Parchment documents are based on Quill.js <a href="https://quilljs.com/docs/delta/">Delta</a> format. Deltas are
simple and expressive format of describing rich text data, and is also
suitable for <a href="https://en.wikipedia.org/wiki/Operational_transformation">Operational transformations</a>. The format is
essentially JSON, and is human readable.</p>

<blockquote>
  <p>Official implementation of Delta format is written in
<a href="https://github.com/quilljs/delta">JavaScript</a> but it was ported to Dart and is available
on <a href="https://pub.dev/packages/quill_delta">Pub</a>. Examples in this document use Dart syntax.</p>
</blockquote>

<h3 id="deltas-quick-start">Deltas quick start</h3>

<p>All Deltas consist of three operations: <code class="language-plaintext highlighter-rouge">insert</code>, <code class="language-plaintext highlighter-rouge">delete</code> and <code class="language-plaintext highlighter-rouge">retain</code>. The
example below describes the string “Karl the Fog” where “Karl” is bolded
and “Fog” is italic:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="n">delta</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Delta</span><span class="o">();</span>
<span class="n">delta</span>
  <span class="o">..</span><span class="na">insert</span><span class="o">(</span><span class="s">'Karl'</span><span class="o">,</span> <span class="o">{</span><span class="s">'bold'</span><span class="o">:</span> <span class="kc">true</span><span class="o">})</span>
  <span class="o">..</span><span class="na">insert</span><span class="o">(</span><span class="s">' the '</span><span class="o">)</span>
  <span class="o">..</span><span class="na">insert</span><span class="o">(</span><span class="s">'Fog'</span><span class="o">,</span> <span class="o">{</span><span class="s">'italic'</span><span class="o">:</span> <span class="kc">true</span><span class="o">});</span>
<span class="n">print</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">delta</span><span class="o">));</span>
<span class="c1">// Prints:</span>
<span class="c1">// [</span>
<span class="c1">//   {"insert":"Karl","attributes":{"bold":true}},</span>
<span class="c1">//   {"insert":" the "},</span>
<span class="c1">//   {"insert":"Fog","attributes":{"italic":true}}</span>
<span class="c1">// ]</span>
</code></pre></div></div>

<p>Above delta is usually also called “document delta” because it consists
of only <code class="language-plaintext highlighter-rouge">insert</code> operations.</p>

<p>Below example describes a <em>change</em> where “Fog” gets also styled as bold:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="n">delta</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Delta</span><span class="o">();</span>
<span class="n">delta</span><span class="o">..</span><span class="na">retain</span><span class="o">(</span><span class="mi">9</span><span class="o">)..</span><span class="na">retain</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="o">{</span><span class="s">'bold'</span><span class="o">:</span> <span class="kc">true</span><span class="o">});</span>
<span class="n">print</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">delta</span><span class="o">));</span>
<span class="c1">// Prints:</span>
<span class="c1">// [{"retain":9},{"retain":3,"attributes":{"bold":true}}]</span>
</code></pre></div></div>

<p>A simple way to visualize a change is as if it moves an imaginary cursor
and applies modifications on the way. So with the above example, the
first <code class="language-plaintext highlighter-rouge">retain</code> operation moves the cursor forward 9 characters. Then,
second operation moves cursor additional 3 characters forward but also
applies bold style to each character it passes.</p>

<p>The Delta library provides a way of composing such changes into documents
or transforming against each other. E.g.:</p>

<div class="language-dart highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Delta</span><span class="o">();</span>
<span class="n">doc</span>
  <span class="o">..</span><span class="na">insert</span><span class="o">(</span><span class="s">'Karl'</span><span class="o">,</span> <span class="o">{</span><span class="s">'bold'</span><span class="o">:</span> <span class="kc">true</span><span class="o">})</span>
  <span class="o">..</span><span class="na">insert</span><span class="o">(</span><span class="s">' the '</span><span class="o">)</span>
  <span class="o">..</span><span class="na">insert</span><span class="o">(</span><span class="s">'Fog'</span><span class="o">,</span> <span class="o">{</span><span class="s">'italic'</span><span class="o">:</span> <span class="kc">true</span><span class="o">});</span>
<span class="kd">var</span> <span class="n">change</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Delta</span><span class="o">();</span>
<span class="n">change</span><span class="o">..</span><span class="na">retain</span><span class="o">(</span><span class="mi">9</span><span class="o">)..</span><span class="na">retain</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="o">{</span><span class="s">'bold'</span><span class="o">:</span> <span class="kc">true</span><span class="o">});</span>
<span class="kd">var</span> <span class="n">updatedDoc</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="na">compose</span><span class="o">(</span><span class="n">change</span><span class="o">);</span>
<span class="n">print</span><span class="o">(</span><span class="n">json</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">updatedDoc</span><span class="o">));</span>
<span class="c1">// Prints:</span>
<span class="c1">//  [</span>
<span class="c1">//    {"insert":"Karl","attributes":{"bold":true}},</span>
<span class="c1">//    {"insert":" the "},</span>
<span class="c1">//    {"insert":"Fog","attributes":{"italic":true,"bold":true}}</span>
<span class="c1">//  ]</span>
</code></pre></div></div>

<p>These are the basics of Deltas. Read <a href="https://quilljs.com/docs/delta/">official documentation</a>
for more details.</p>

<h3 id="document-model">Document model</h3>

<p>Parchment documents are represented as a tree of nodes. There are 3 main
types of nodes:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">LeafNode</code> - a leaf node which represents a segment of styled text within a document. There are two kinds of leaf nodes - text and embeds.</li>
  <li><code class="language-plaintext highlighter-rouge">LineNode</code> - represents an individual line of text within a document. Line nodes are containers for leaf nodes.</li>
  <li><code class="language-plaintext highlighter-rouge">Block</code> - represents a group of adjacent lines which share the same style. Examples of blocks include lists, quotes or code blocks.</li>
</ul>

<p>Given above description, here is ASCII-style visualization of a Parchment
document tree:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root
 ╠═ block
 ║   ╠═ line
 ║   ║   ╠═ text
 ║   ║   ╚═ text
 ║   ╚═ line
 ║       ╚═ text
 ╠═ line
 ║   ╚═ text
 ╚═ block
     ╚═ line
         ╠═ text
         ╚═ text
</code></pre></div></div>

<p>It is currently not allowed to nest blocks inside other blocks but this
may change in the future.</p>

<p>All manipulations of Parchment documents are designed strictly to match
semantics of underlying Delta format. As a result the model itself is
fairly simple and predictable.</p>

<p>Learn more about other building blocks of Parchment documents in
documentation for <a href="/doc/concepts/attributes.html">attributes</a> and <a href="/doc/concepts/heuristics.html">heuristics</a>.</p>


      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        
        <p class="copyright">Fleather maintained by <a href="https://github.com/fleather-editor">fleather-editor</a></p>
        
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>
  </body>
</html>
